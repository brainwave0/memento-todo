function to_array(iterable){var result=[];for(var i=0;i<iterable.length;i++){result.push(iterable[i])}return result}function ready(task){return!task.field("Start datetime")||task.field("Start datetime").getTime()<=Date.now()}function active_tasks(){return to_array(lib().entries()).filter(function(x){return ready(x)})}function get_all_tasks(){return to_array(lib().entries())}function sum(nums,f){if(f===void 0){f=id}return nums.map(f).reduce(function(a,b){return a+b},0)}function shuffle_array(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}return array}var SortDir;(function(SortDir){SortDir[SortDir["Ascending"]=0]="Ascending";SortDir[SortDir["Descending"]=1]="Descending"})(SortDir||(SortDir={}));function sort(elems,field_selector,sort_direction){if(sort_direction==SortDir.Ascending){return elems.sort(function(a,b){return field_selector(a)-field_selector(b)})}else{return elems.sort(function(a,b){return field_selector(b)-field_selector(a)})}}function copy_array(xs){var result=[];for(var _i=0,xs_1=xs;_i<xs_1.length;_i++){var x=xs_1[_i];result.push(x)}return result}function assert(p,msg){if(!p){throw msg}}function id(x){return x}function array_equals2(ass,bss){if(ass.length!=bss.length){return false}for(var i=0;i<ass.length;i++){if(!array_equals(ass[i],bss[i])){return false}}return true}function array_equals(as,bs){if(as.length!=bs.length){return false}for(var i=0;i<as.length;i++){if(as[i]!=bs[i]){return false}}return true}function random_choice(xs){return xs[Math.round(Math.random()*(xs.length-1))]}function average_priority(){var all_tasks=get_all_tasks();return sum(all_tasks.map(function(x){return x.field("Importance")}))/all_tasks.length}function weighted_random_choice(choices,weights){var sum_weights=0;var cdf=[];for(var _i=0,weights_1=weights;_i<weights_1.length;_i++){var weight=weights_1[_i];sum_weights+=weight;cdf.push(weight/sum_weights)}return choices[find_closest_index(weights,Math.random())]}function find_closest_index(array,target){var delta=array.length-1;var index=delta;while(delta>0){delta=delta/2;if(array[index]>target){index=Math.round(index-delta)}else if(array[index]<target){index=Math.round(index+delta)}else{break}}return index}function unique(xs,f){if(f===void 0){f=id}var results=[];for(var _i=0,xs_2=xs;_i<xs_2.length;_i++){var x=xs_2[_i];if(results.map(f).indexOf(f(x))==-1){results.push(x)}}return results}function xbisect(value,more){if(!value){return 1}if(Math.log(value)/Math.log(2)%1===0){if(more){return value*2}else if(value==1){return value/2}else{return value-value/4}}var x=1;while(x<value){x*=2}var delta=x;while(x!=value){delta/=2;if(x<value){x+=delta}else if(x>value){x-=delta}}if(more){x+=delta/2}else{x-=delta/2}return x}function reschedule(){if(arg("Adjust repeat interval")=="Less"){bisect_repeat_interval(false)}else if(arg("Adjust repeat interval")=="More"){bisect_repeat_interval(true)}if(arg("Specific datetime")){entry().set("Start datetime",arg("Specific datetime"))}else if(arg("Repeat Interval")){entry().set("Start datetime",new Date(Date.now()+entry().field("Repeat Interval")))}else if(arg("Specific duration")){entry().set("Start datetime",new Date(Date.now()+arg("Specific duration")))}}function bisect_repeat_interval(more){entry().set("Repeat Interval",xbisect(entry().field("Repeat Interval")/1000/60/60,more)*1000*60*60)}